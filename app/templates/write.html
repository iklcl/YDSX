{% extends 'base.html' %}

{% block head %}
{% endblock %}
{% block  title  %}
车辆管理
{% endblock %}

{% block main %}
    <div class="content-wrapper"  style="margin-left:14%;margin-top: 10px">
        <!--内容-->
        <section class="content-header">
            <ol class="breadcrumb">
                <li><a href="{{ url_for('home.detail') }}"><i class="fa fa-dashboard"></i> 车辆管理</a></li>
                <li class="active">信息编辑</li>
            </ol>
        </section>
        <section class="content" id="showcontent" style="margin-left:5%;margin-right: 20%;margin-bottom: 200px;">
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-primary">
                        <form id="form1" onsubmit="return false" action="#" method="post">
                            {% if car_target %}
                                <input type="hidden" id="id" name="id" value="{{ car_target.id }}">
                                <input type="hidden" id="isAdd" name="add" value="">
                                <div class="box-body">
                                    <div class="form-group">
                                        <label for="input_title">车牌号</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="请输入车名！（必填）" value="{{ car_target.carname }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">终端id</label>
                                        <input type="text" class="form-control" id="terminalid" name="terminalid" placeholder="请输入id！（必填）" value="{{ car_target.terminalid }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">司机</label>
                                        <input type="text" class="form-control" name="driver" id="driver"  value="{{ car_target.driver }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">电话号码</label>
                                        <input type="text" class="form-control" name="driverphone" id="driverphone" value="{{ car_target.driverphone }}" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">始发车时间</label>
                                        <input type="time" class="form-control"  name="starttime" id="starttime" value="{{ car_target.starttime }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">末班车时间</label>
                                        <input type="time" class="form-control"  id="endtime" name="endtime" value="{{ car_target.endtime }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">运营单位</label>
                                        <input type="text" class="form-control" id="company" name="company" value="{{ car_target.company }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">型号</label>
                                        <input type="text" class="form-control" id="cartype" name="cartype" value="{{ car_target.cartype }}">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_release_time">车队</label>
                                        <input type="text" class="form-control" id="team" name="team" value="{{ car_target.team }}">
                                    </div>
                                     <div class="form-group">
                                        <p class="text-succcess" style="float: left">修改状态：</p>
                                            <select id="changeState" name="state" class="shortselect" value="{{ car_target.carstate }}">
                                                <option value="在线">在线</option>
                                                <option value="离线">离线</option>
                                            </select>
                                     </div>
                                </div>
                                <div class="box-footer">
                                    <button type="submit" class="btn btn-primary" onclick="over()">保存</button>
                                </div>
                            {% else %}
                                <input type="hidden" id="isAdd" name="add" value="yes">
                                <div class="box-body">
                                    <div class="form-group">
                                        <label for="input_title">车名</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="请输入车名！（必填）">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">终端id</label>
                                        <input type="text" class="form-control" id="terminalid" name="terminalid" placeholder="请输入id！（必填）">
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">司机</label>
                                        <input type="text" class="form-control" name="driver" id="driver" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">电话号码</label>
                                        <input type="text" class="form-control" name="driverphone" id="driverphone" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">始发车时间</label>
                                        <input type="time" class="form-control" name="starttime" id="starttime" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">末班车时间</label>
                                        <input type="time" class="form-control" id="endtime" name="endtime" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">运营单位</label>
                                        <input type="text" class="form-control" id="company" name="company" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_area">型号</label>
                                        <input type="text" class="form-control" id="cartype" name="cartype" >
                                    </div>
                                    <div class="form-group">
                                        <label for="input_release_time">车队</label>
                                        <input type="text" class="form-control" id="team" name="team">
                                    </div>
                                    <div class="form-group">
                                        <p class="text-succcess" style="float: left">修改状态：</p>

                                            <select id="changeState" name="state" class="shortselect" >
                                                <option value="在线">在线</option>
                                                <option value="离线">离线</option>
                                            </select>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <button type="submit" class="btn btn-primary" onclick="over()">添加</button>
                                </div>
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>
<script>
    //修改添加完成
function over() {
    var param = {};
    function appendInfo(id) {
        var formData = $("#" + id).serializeArray();//把form里面的数据序列化成数组
        formData.forEach(function (e) {
            if (e.value != '00') {
                param[e.name] = e.value;
            }
        });
    }
    appendInfo("form1");
    if(
        param.terminalid.replace(/\s*/g, "")==""||param.name.replace(/\s*/g, "")==""
    ){
        alert("名称和终端号不能为空！")
        return false;
    }
    var isadd = document.getElementById("isAdd").value;
    if (isadd) {
        $.post("/add/", param, function (data) {
            alert("添加"+data);
            window.location.href="/detail/";
{#            refreshParent();#}
        });

    }
    else {
        $.post("/add/", param, function (data) {
            alert("修改"+data);
            window.location.href="/detail/";
{#             refreshParent();#}
        });

    }
}

</script>
{% endblock %}